<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.53">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Simon Ghyselincks, Team 2411">
<meta name="dcterms.date" content="2024-04-22">

<title>Dynamics and Control – Simon Ghyselincks</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../">
<link href="../../../../content/projects/RLUnicycle/telemetry/telemetry.html" rel="prev">
<script src="../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../../index.html">
    <span class="navbar-title">Simon Ghyselincks</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../../../../content/projects/RLUnicycle/introduction.html" aria-current="page"> 
<span class="menu-text">Learning to Balance</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../blog/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../content/eosc555/index.html"> 
<span class="menu-text">EOSC 555</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../content/about/biography.html"> 
<span class="menu-text">Bio</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../../content/projects/projects.html">Projects</a></li><li class="breadcrumb-item"><a href="../../../../content/projects/RLUnicycle/introduction.html">Learning to Balance</a></li><li class="breadcrumb-item"><a href="../../../../content/projects/RLUnicycle/dynamics/dynamics.html">Dynamics and Control</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Projects</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../content/projects/projects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Project Home</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Learning to Balance</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../content/projects/RLUnicycle/introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../content/projects/RLUnicycle/rtkernel/rtpatch.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">RT Kernel on Jetson Nano</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../content/projects/RLUnicycle/telemetry/telemetry.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Telemetry and Database System</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../content/projects/RLUnicycle/dynamics/dynamics.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Dynamics and Control</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul class="collapse">
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#problem-description" id="toc-problem-description" class="nav-link" data-scroll-target="#problem-description">Problem Description</a></li>
  <li><a href="#parameter-measurement" id="toc-parameter-measurement" class="nav-link" data-scroll-target="#parameter-measurement">Parameter Measurement</a>
  <ul class="collapse">
  <li><a href="#mass-and-center-of-mass-measurements" id="toc-mass-and-center-of-mass-measurements" class="nav-link" data-scroll-target="#mass-and-center-of-mass-measurements">Mass and Center of Mass Measurements</a></li>
  <li><a href="#inertia-calculations" id="toc-inertia-calculations" class="nav-link" data-scroll-target="#inertia-calculations">Inertia Calculations</a></li>
  </ul></li>
  <li><a href="#lagrangian-derivation" id="toc-lagrangian-derivation" class="nav-link" data-scroll-target="#lagrangian-derivation">Lagrangian Derivation</a>
  <ul class="collapse">
  <li><a href="#kinetic-energy" id="toc-kinetic-energy" class="nav-link" data-scroll-target="#kinetic-energy">Kinetic Energy</a></li>
  <li><a href="#potential-energy" id="toc-potential-energy" class="nav-link" data-scroll-target="#potential-energy">Potential Energy</a></li>
  </ul></li>
  <li><a href="#equations-of-motion" id="toc-equations-of-motion" class="nav-link" data-scroll-target="#equations-of-motion">Equations of Motion</a>
  <ul class="collapse">
  <li><a href="#matlab-derivation" id="toc-matlab-derivation" class="nav-link" data-scroll-target="#matlab-derivation">Matlab Derivation</a></li>
  <li><a href="#derived-equations-of-motion" id="toc-derived-equations-of-motion" class="nav-link" data-scroll-target="#derived-equations-of-motion">Derived Equations of Motion</a></li>
  </ul></li>
  <li><a href="#controls-derivation" id="toc-controls-derivation" class="nav-link" data-scroll-target="#controls-derivation">Controls Derivation</a>
  <ul class="collapse">
  <li><a href="#linearization" id="toc-linearization" class="nav-link" data-scroll-target="#linearization">Linearization</a></li>
  <li><a href="#matlab-derivation-1" id="toc-matlab-derivation-1" class="nav-link" data-scroll-target="#matlab-derivation-1">MATLAB Derivation</a></li>
  <li><a href="#system-transfer-function" id="toc-system-transfer-function" class="nav-link" data-scroll-target="#system-transfer-function">System Transfer Function</a></li>
  </ul></li>
  <li><a href="#controls-policy" id="toc-controls-policy" class="nav-link" data-scroll-target="#controls-policy">Controls Policy</a>
  <ul class="collapse">
  <li><a href="#pd-controller-for-pendulum-angle" id="toc-pd-controller-for-pendulum-angle" class="nav-link" data-scroll-target="#pd-controller-for-pendulum-angle">PD Controller for Pendulum Angle</a></li>
  <li><a href="#pi-controller-for-wheel-velocity" id="toc-pi-controller-for-wheel-velocity" class="nav-link" data-scroll-target="#pi-controller-for-wheel-velocity">PI Controller for Wheel Velocity</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../../content/projects/projects.html">Projects</a></li><li class="breadcrumb-item"><a href="../../../../content/projects/RLUnicycle/introduction.html">Learning to Balance</a></li><li class="breadcrumb-item"><a href="../../../../content/projects/RLUnicycle/dynamics/dynamics.html">Dynamics and Control</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Dynamics and Control</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Simon Ghyselincks, Team 2411 </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 22, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>The following is a demonstration of the derivation for the equations of motion for a single degree of freedom reaction wheel inverted pendulum. The approach used is energy methods via the Lagrangian using classical mechanics.</p>
<p>An automated derivation sequence using MATLAB is presented, which allows for parsing the equations of motion for an arbitrary system such as a 4-DOF unicycle robot. The code for the auto-derivation has been tested by hand against known solutions in the literature, as explored by <span class="citation" data-cites="Brevik2017">(<a href="#ref-Brevik2017" role="doc-biblioref">Brevik 2017</a>)</span>, <span class="citation" data-cites="Montoya2020">(<a href="#ref-Montoya2020" role="doc-biblioref">Montoya and Gil-González 2020</a>)</span>.</p>
</section>
<section id="problem-description" class="level1">
<h1>Problem Description</h1>
<div id="fig:pendulum" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Inverted Reaction Wheel.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption>The dynamics of the reaction wheel pendulum.</figcaption>
</figure>
</div>
<p>The inverted pendulum is attached to a hinge point at A and has a flywheel mounted to a motor at C. The analysis of the problem involves two rigid bodies: the pendulum arm and the spinning flywheel. The parameters of importance for each are</p>
<ul>
<li><p><span class="math inline">\(l\)</span>, the distance from the rotation point A to the center of mass of the body.</p></li>
<li><p><span class="math inline">\(I\)</span>, the moment of inertia of the body about its centroid.</p></li>
<li><p><span class="math inline">\(m\)</span>, the total mass of the body.</p></li>
</ul>
<p>We use the subscript <span class="math inline">\(_p\)</span> for pendulum properties and <span class="math inline">\(_w\)</span> for wheel properties. <span class="math inline">\(l_p = \bar{AB}\)</span>, <span class="math inline">\(l_m = \bar{AC}\)</span></p>
<p>The properties in practice are determined experimentally or with the assistance of CAD.</p>
<p>Since we are restricted to the 2D plane in this single degree of freedom problem, there is only a single moment of inertia instead of a tensor like in the case of 3D.</p>
<p>We also specify our general coordinates for the problem. Importantly the angle <span class="math inline">\(\theta\)</span> is chosen relative to the pendulum arm since this is what is measurable by an encoder on the joint. The angle <span class="math inline">\(\phi\)</span> is measured relative to the vertical, a configuration suitable for either an encoder at <span class="math inline">\(A\)</span> or an IMU referencing gravity.</p>
</section>
<section id="parameter-measurement" class="level1">
<h1>Parameter Measurement</h1>
<section id="mass-and-center-of-mass-measurements" class="level2">
<h2 class="anchored" data-anchor-id="mass-and-center-of-mass-measurements">Mass and Center of Mass Measurements</h2>
<p>The mass and center of mass (CM) were measured using a lab scale and a balancing method, respectively.</p>
<ul>
<li><p><strong>Flywheel:</strong> The wheel and rings mass (denoted as <span class="math inline">\(m_w\)</span>) was measured to be 346g. The CM of the wheel from the pendulum hinge (denoted as <span class="math inline">\(l_w\)</span>) is 180mm. This was measured in CAD and also with a ruler.</p></li>
<li><p><strong>Pendulum and Motor:</strong> The combined mass of the pendulum and motor with stator (denoted as <span class="math inline">\(m_p\)</span>) was measured to be 531g. The CM of the pendulum with motor and stator (denoted as <span class="math inline">\(l_p\)</span>) is 100mm. The pendulum CM is found by balancing the apparatus with removed flywheel overtop of a fulcrum and finding the stable resting point position.</p></li>
</ul>
</section>
<section id="inertia-calculations" class="level2">
<h2 class="anchored" data-anchor-id="inertia-calculations">Inertia Calculations</h2>
<p>The moment of inertia for each component was calculated using the parallel axis theorem and the physical dimensions provided by CAD models and direct measurement.</p>
<section id="wheel-inertia" class="level3">
<h3 class="anchored" data-anchor-id="wheel-inertia">Wheel Inertia</h3>
<p>The wheel inertia (denoted as <span class="math inline">\(I_w\)</span>) was found by comparing the CAD weight to the measured weight of the flywheel to find agreement: <span class="math display">\[I_w = 725\ \text{kg}\cdot\text{mm}^2\]</span> In particular the metal rings were weighed and set to be the same weight in CAD which is the most influential part of the moment in question.</p>
</section>
<section id="pendulum-inertia" class="level3">
<h3 class="anchored" data-anchor-id="pendulum-inertia">Pendulum Inertia</h3>
<p>The pendulum moment of inertia (denoted as <span class="math inline">\(I_p\)</span>) is a composite value derived from the inertia of individual components:</p>
<ol type="1">
<li><p><strong>Battery:</strong> The battery contributes an inertia of: <span class="math display">\[I_{\text{battery}} = \frac{1}{12} \cdot 0.185 \cdot (70^2 + 35^2) + 0.185 \cdot 50^2 = 446\ \text{kg}\cdot\text{mm}^2\]</span></p></li>
<li><p><strong>Pendulum Arm:</strong> The corrected inertia for the pendulum arm is: <span class="math display">\[I_{\text{arm}} = 346\ \text{kg}\cdot\text{mm}^2 + 0.102 \cdot 45^2 = 552\ \text{kg}\cdot\text{mm}^2\]</span></p></li>
<li><p><strong>Motor and Mount:</strong> The combined inertia for the motor and mount is: <span class="math display">\[I_{\text{motor}} = 0.5 \cdot 0.206 \cdot 30^2 + 0.206 \cdot 75^2 = 1251.75\ \text{kg}\cdot\text{mm}^2\]</span></p></li>
</ol>
<p>The total pendulum inertia is then calculated as the sum of the components: <span class="math display">\[I_p = I_{\text{battery}} + I_{\text{arm}} + I_{\text{motor}} = 2250\ \text{kg}\cdot\text{mm}^2\]</span></p>
</section>
</section>
</section>
<section id="lagrangian-derivation" class="level1">
<h1>Lagrangian Derivation</h1>
<p>Our generalized coordinates are <span class="math display">\[\vec{q} = \begin{bmatrix}
    \varphi \\[0.3em] \theta
\end{bmatrix}, \quad \text{and} \quad \frac{d}{dt}\vec{q} = \dot{\vec{q}} = \begin{bmatrix}
    \dot{\varphi} \\[0.3em] \dot{\theta}
\end{bmatrix}\]</span></p>
<p>We derive the kinetic and potential energy of the system first:</p>
<section id="kinetic-energy" class="level2">
<h2 class="anchored" data-anchor-id="kinetic-energy">Kinetic Energy</h2>
<p><span class="math display">\[\begin{aligned}
T &amp;= T_p+T_w \\
T_p &amp;= \frac{1}{2}(\underbrace{I_p + m_pl_p^2}_{\text{Parallel Axis Theorem}})\dot{\varphi}^2\\
T_w&amp;=\frac{1}{2}m_w(\underbrace{l_w\dot{\varphi}}_{\text{Speed of CM}})^2 +  \frac{1}{2}I_w(\underbrace{\dot{\varphi}+\dot{\theta}}_{\text{net rotation earth frame}})^2\\
T_{net} &amp;= \frac{1}{2} \left(I_p + m_p l_p^2 + I_w + m_w l_w^2\right) \dot{\varphi}^2 + \frac{1}{2} I_w (\dot{\varphi} + \dot{\theta})^2 \\
&amp;= \frac{1}{2} \left(I_p + m_p l_p^2\right) \dot{\varphi}^2 + \frac{1}{2} I_w \left(\dot{\varphi}^2 + 2\dot{\varphi}\dot{\theta} + \dot{\theta}^2\right)\\
T_{net}&amp;=\frac{1}{2} [\dot{\varphi}, \dot{\theta}] \begin{bmatrix}
    I_p + m_pl_p^2 + I_w + m_wl_w^2 &amp; I_w \\
    I_w &amp; I_w
\end{bmatrix} \begin{bmatrix}
    \dot{\varphi} \\
\dot{\theta}
\end{bmatrix}
\end{aligned}\]</span></p>
<p>This gives the form using the inertia matrix M, note the matrix is always symmetric.</p>
</section>
<section id="potential-energy" class="level2">
<h2 class="anchored" data-anchor-id="potential-energy">Potential Energy</h2>
<p>The potential energy is taken by projecting the position of the center of masses onto the vertical axis using <span class="math inline">\(\cos(\varphi)\)</span>, noting that the angle <span class="math inline">\(\theta\)</span> has no impact on the potential since the wheel is radially symmetric. <span class="math display">\[U = (m_pl_p + m_wl_w)g \cos (\varphi) = m_0 \cos (\varphi)\]</span> We can simplify future equations by assigning an equivalent variable <span class="math inline">\(m_0 = (m_p l_p + m_w l_w)g\)</span></p>
<p>This gives the complete Lagrangian <span class="math display">\[\mathcal{L}(\varphi,\theta,\dot \varphi,\dot \theta)= KE - PE = \frac{1}{2}\mathbf{\dot q}^{T}\mathbf{M}\mathbf{\dot q}-m_0cos(\varphi)\]</span></p>
</section>
</section>
<section id="equations-of-motion" class="level1">
<h1>Equations of Motion</h1>
<p>The Euler-Lagrange equations for each coordinate will inform the equations of motion: <span class="math display">\[0 = \underbrace{\frac{\partial \mathcal{L}(q,\dot{q},t)}{\partial q} - \frac{d}{dt}(\frac{ \partial \mathcal{L}(q,\dot{q},t)}{\partial \dot{q}}}_{\text{Euler-Lagrange Equation}})\]</span></p>
<p>The non-conservative force of the torque is incorporated by having the equation not sum to zero, but instead the sum of non-conservative forces/torques. The details of this style of derivation can be found in <span class="citation" data-cites="Brevik2017">(<a href="#ref-Brevik2017" role="doc-biblioref">Brevik 2017</a>)</span> Section 3.3.2.</p>
<p>These equations can be derived by hand, but all of the necessary information for the problem is already encoded in the starting Lagrangian. All equations of motion that follow are merely an algorithmic process, one that is prone to errors as well. For efficiency, it is preferable to devise a method to automatically differentiate.</p>
<section id="matlab-derivation" class="level2">
<h2 class="anchored" data-anchor-id="matlab-derivation">Matlab Derivation</h2>
<p>The required files to run this code are included at <a href="https://github.com/Team-2411-RL-Unicycle/pid-control" class="uri">https://github.com/Team-2411-RL-Unicycle/pid-control</a> The automated E-L solver uses a modified version of a file made by <span class="citation" data-cites="Veng2023EulerLagrangeSolver">(<a href="#ref-Veng2023EulerLagrangeSolver" role="doc-biblioref">Veng 2023</a>)</span>. It is incorporated into the RWIPpid_derivation.m file. The derivation technique is validated against the equations derived by <span class="citation" data-cites="Brevik2017">(<a href="#ref-Brevik2017" role="doc-biblioref">Brevik 2017</a>)</span>.</p>
<p>The first step is to define symbolic variables for all of the parameters, states, and inputs</p>
<pre id="lst:matlab_code" data-caption="MATLAB Code" label="lst:matlab_code"><code>syms mp lp Ip mw lw Iw real
params = [mp, lp, Ip, mw, lw, Iw];
% Define numerical values for the parameters
values = [.531, 0.100, 0.002250, .346, 0.180, 0.000725];
g=9.81;
% State variables
syms phi theta dphi dtheta real
q = [phi, theta];
dq = [dphi, dtheta];
% Input
syms tau real

% Potential energy mass
m0 = (mp*lp + mw*lw)*g; % Effective U=mgh for combined parts
% Mass matrix
M = [(Ip + mp*lp^2 + Iw +mw*lw^2), Iw;
    Iw, Iw];
lagrangian = (1/2)*([dphi, dtheta])*M*([dphi, dtheta]') - m0 * cos(phi);
% Non-conservative forces in each coordinate q
Q = [0, tau];</code></pre>
<p>The Lagrangian and its non-conservative forces are fully defined now. The equations are solved using the modified imported library and the solution equations for each second time derivative is solved giving <span class="math inline">\(\frac{d}{dt}\dot{q}\)</span>, these solutions can be packed into a single array to form a matrix.</p>
<pre id="lst:matlab_code" data-caption="MATLAB Code" label="lst:matlab_code"><code>[eqs, ddq] = EulerLagrange(q,dq,lagrangian,Q);
% Explicit equations:
exp_eqs = ddq == eqs;
% Solve equations to isolate ddphi and ddtheta
ddqSolutions = solve(ddq == eqs, ddq);
% Convert solutions to cell array
ddqSolutionEquations = struct2cell(ddqSolutions) ;
ddqArray = [ddqSolutionEquations{:}].';</code></pre>
</section>
<section id="derived-equations-of-motion" class="level2">
<h2 class="anchored" data-anchor-id="derived-equations-of-motion">Derived Equations of Motion</h2>
<p>Once we have <span class="math inline">\(n\)</span> 2nd order ODEs for <span class="math inline">\(n\)</span> general coordinates and their <span class="math inline">\(n\)</span> general time derivatives we have enough to make a first order system of ODEs that characterize the system. The time-domain non-linearized result from the derivation is given below.</p>
<p><span class="math display">\[\frac{d}{dt}\vec{x} = \vec{G}(\vec{x}, t) = \begin{bmatrix}
d\varphi \\
d\theta \\
\frac{g_0 l_p m_p \sin(\phi) - \tau + g_0 l_w m_w \sin(\phi)}{m_p l_p^2 + m_w l_w^2 + I_p} \\
\frac{m_p \tau l_p^2 - I_w g_0 m_p \sin(\phi) l_p + m_w \tau l_w^2 - I_w g_0 m_w \sin(\phi) l_w + I_p \tau + I_w \tau}{I_w (m_p l_p^2 + m_w l_w^2 + I_p)}
\end{bmatrix}, \quad x = \begin{bmatrix}
\varphi \\ \theta \\ \dot{\varphi} \\ \dot{\theta}
\end{bmatrix}\]</span></p>
<p>Note that there is no explicit time dependence in the function <span class="math inline">\(G\)</span> the inverted pendulum dynamics and rigid body characteristics are constant over time. From inspection of the solutions we see that <span class="math inline">\(\theta\)</span>, the angle of the wheel does not play a role in the function <span class="math inline">\(G\)</span> and can be removed entirely if desired.</p>
<p>These system dynamics can be used to create a time-domain non-linear simulation using Euler’s method to get numerical solutions. Friction can be added as a damping coefficient <span class="math inline">\(\beta\)</span> such that we superimpose <span class="math inline">\(\ddot{\varphi} = - \beta \dot{\varphi}\)</span> onto the solution for example.</p>
</section>
</section>
<section id="controls-derivation" class="level1">
<h1>Controls Derivation</h1>
<p>Now that the system dynamics are recovered we want to work in the Laplace domain for control. To do so, we need to get a linearized form of this non linear vector equation. This is similar to defining a first-order approximation to a single variable function: <span class="math inline">\(f(x) \approx f(x_0) + f'(x_0)\cdot (x_0 - x)\)</span>. In this case the linearation happens about a vector in state-space and we use the Jacobian as the multivariate generlization of the first derivative.</p>
<p>For more information on this process refer to</p>
<p><strong><a href="https://inst.eecs.berkeley.edu/~ee16b/sp21/notes/sp21/note15.pdf">Berkley Designing Information Devices and Systems II</a></strong> <span class="citation" data-cites="berkeley2021designing">(<a href="#ref-berkeley2021designing" role="doc-biblioref">University of California, Berkeley 2021</a>)</span></p>
<p><strong><a href="https://www.cds.caltech.edu/~murray/courses/cds101/fa02/caltech/pph02-ch19-23.pdf">Caltech Jacobian Linearization</a></strong> <span class="citation" data-cites="caltech2002jacobian">(<a href="#ref-caltech2002jacobian" role="doc-biblioref">California Institute of Technology 2002</a>)</span></p>
<section id="linearization" class="level2">
<h2 class="anchored" data-anchor-id="linearization">Linearization</h2>
<p>We wish to convert <span class="math display">\[\vec{G}(\vec{x}, t) \approx Ax + Bu\]</span> via linearization about the operating point. We choose the upright position as the target and note that <span class="math inline">\(\varphi\)</span> is the only variable present in <span class="math inline">\(G\)</span>. <span class="math inline">\(\hat{\vec{x}}=0\)</span> is the chosen linearization point:</p>
<p><span class="math display">\[\frac{d}{dt}\vec{x} \approx \hat{\vec{x}} + \left. \text{Jacobian}\{\vec{G}(\vec{x}, t)\} \right|_{\vec{x}=\hat{\vec{x}}} (\vec{x}-\hat{\vec{x}}) = \left. \Big(A\Big) \right|_{\vec{x}=\hat{\vec{x}}} \vec{x}\]</span></p>
<p>We perform a similar linearization to get the effect of the system inputs by taking the Jacobian with respect to <span class="math inline">\(\tau\)</span>. The two combined give the cannonical <span class="math inline">\(\frac{d}{dt}x = Ax + Bu\)</span> of controls engineering. The final step is to take the Laplace transform of the entire equation and then solve for the transfer function between the system inputs <span class="math inline">\(u\)</span> or in this case <span class="math inline">\(\tau\)</span> and the observables we want (mainly the system state <span class="math inline">\(x\)</span>) but this generalizes to any observable that is a function of <span class="math inline">\(x\)</span> and <span class="math inline">\(u\)</span></p>
<p><strong>State Vector</strong> <span class="math display">\[{\mathbf{x}} =
\begin{bmatrix}
    x_1 \\
    x_2 \\
    \vdots
\end{bmatrix}\]</span> <strong>Input Vector</strong> <span class="math display">\[{\mathbf{u}} =
\begin{bmatrix}
    u_1 \\
    u_2 \\
    \vdots
\end{bmatrix}\]</span> <strong>Output Vector</strong> <span class="math display">\[{\mathbf{y}} =
\begin{bmatrix}
    y_1 \\
    y_2 \\
    \vdots
\end{bmatrix}\]</span></p>
<p><strong>State Equation</strong> <span class="math display">\[\dot{\mathbf{x}} =
\begin{bmatrix}
    \dot{x}_1 \\
    \dot{x}_2 \\
    \vdots
\end{bmatrix}
= \mathbf{A}{\mathbf{x}} + \mathbf{B}{\mathbf{u}}\]</span> <strong>Output Equation</strong> <span class="math display">\[{\mathbf{y}} = \mathbf{C}{\mathbf{x}} + \mathbf{D}{\mathbf{u}}\]</span></p>
<p><strong>State Transition Matrix</strong> <span class="math display">\[\mathbf{\Phi} = (s\mathbf{I} - \mathbf{A})^{-1}\]</span> <strong>Transfer Functions</strong> <span class="math display">\[\frac{{\mathbf{y}}}{{\mathbf{u}}} = \mathbf{C}\mathbf{\Phi}\mathbf{B} + \mathbf{D}\]</span></p>
<p>We solve for the transfer matrix <span class="math inline">\(y = Gu\)</span> at <span class="math inline">\(x=0\)</span>, noting that in our case <span class="math inline">\(y=x\)</span></p>
</section>
<section id="matlab-derivation-1" class="level2">
<h2 class="anchored" data-anchor-id="matlab-derivation-1">MATLAB Derivation</h2>
<pre id="lst:matlab_code" data-caption="MATLAB Code" label="lst:matlab_code"><code>% Phi, dPhi, dTheta
X = [q(1)' ; dq']
% The inputs are non-zero entries of Q (non-conservative forces)
U = Q(Q ~= 0);
% Vector functionn for the derivative of the state vector
dX = [dphi; ddqArray]

% Compute the Jacobian matrices to get nonlinear state matrices dX = Ax + Bu
A = jacobian(dX, X);
B = jacobian(dX, U);

% Substitute or linearize about an equilibrium point
% Define equilibrium point (for example, all zeros)
x0 = [0; 0; 0];
% Substitute equilibrium values x0 into A and B
Aeq = subs(A, X, x0)
Beq = subs(B, X, x0)

% U to X transfer function
% dX = Ax + Bu implies  sX = Ax + Bu, solve for x = Gtf*u
syms s
Gtf = (s*eye(length(X)) - Aeq)^(-1)*Beq</code></pre>
</section>
<section id="system-transfer-function" class="level2">
<h2 class="anchored" data-anchor-id="system-transfer-function">System Transfer Function</h2>
<p><span class="math display">\[\begin{pmatrix}
\varphi(s)\\
\dot{\varphi}(s)\\
\dot\theta(s)
\end{pmatrix}=
\begin{pmatrix}
-\frac{1}{{m_p l_p^2 s^2 - g_0 m_p l_p + m_w l_w^2 s^2 - g_0 m_w l_w + I_p s^2}} \\
-\frac{s}{{m_p l_p^2 s^2 - g_0 m_p l_p + m_w l_w^2 s^2 - g_0 m_w l_w + I_p s^2}} \\
\frac{{m_p l_p^2 + m_w l_w^2 + I_p + I_w}}{{I_w s (m_p l_p^2 + m_w l_w^2 + I_p)}} + \frac{{g_0 l_p m_p + g_0 l_w m_w}}{{s (m_p l_p^2 + m_w l_w^2 + I_p)(m_p l_p^2 s^2 - g_0 m_p l_p + m_w l_w^2 s^2 - g_0 m_w l_w + I_p s^2)}}
\end{pmatrix}
\tau(s)\]</span></p>
<p>We note that for our control problem we are trying to control the angle <span class="math inline">\(\varphi\)</span> using torque, so the function of interest is the upper row equation:</p>
<p><span class="math display">\[\varphi(s) = \Big(-\frac{1}{{m_p l_p^2 s^2 - g_0 m_p l_p + m_w l_w^2 s^2 - g_0 m_w l_w + I_p s^2}}\Big) \tau(s)\]</span></p>
<p>Or rearranging we see that we have function of the form <span class="math inline">\(\frac{1}{s^2+a^2}\)</span>: <span class="math display">\[\varphi(s) = \left(-\frac{1}{s^2(m_p l_p^2 + m_w l_w^2 + I_p) - m_0}\right) \tau(s)\]</span></p>
<p>This is a function with one pole in the RH plane making it unstable.</p>
</section>
</section>
<section id="controls-policy" class="level1">
<h1>Controls Policy</h1>
<p>There are actually two objectives that are necessary to keep the pendulum balanced upright.</p>
<ol type="1">
<li><p>The angle <span class="math inline">\(\varphi\)</span> should be minimized to 0 degrees where possible.</p></li>
<li><p>The wheel velocity can not exceed the maximum for the motor configuration.</p></li>
</ol>
<p>The wheel velocity in a balancing configuration can be controlled by biasing which side of the unstable equilibrium the pendulum is on. With a functioning and responsive control for <span class="math inline">\(\varphi\)</span>, commanding the robot to hold position on one side of the equilibrium will cause a build-up of torque in one direction. This can be used to apply torque opposite to the direction of the spinning wheel to slow it down.</p>
<div id="fig:pendulum" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="PIDcontroller.drawio.png" class="img-fluid figure-img" style="width:105.0%"></p>
<figcaption>Control Flow Diagram</figcaption>
</figure>
</div>
<p>We read the wheel speed from the wheel encoder and get an error for how far off from zero velocity it is. This is fed through to a PI controller that updates the setpoint objective for the pendulum angle to counteract the velocity. This request is sent to a PD controller which functions off the error between the requested <span class="math inline">\(\varphi\)</span> and the current <span class="math inline">\(\varphi\)</span> as read by the the sensors. Finally this torque request is passed to the motor driver which has a high frequency feedback loop to apply the requested torque.</p>
<section id="pd-controller-for-pendulum-angle" class="level2">
<h2 class="anchored" data-anchor-id="pd-controller-for-pendulum-angle">PD Controller for Pendulum Angle</h2>
<p>The PD Controller for <span class="math inline">\(\varphi\)</span> is tuned using the assumption that the torque requests have little delay before reaching the intended value. This is because the motor controller is running at 100 times faster than the main control loop frequency of 100Hz. Thus we model the feedback loop of Controller -&gt; <span class="math inline">\(G(s)\)</span> -&gt; <span class="math inline">\(H(s)\)</span> Sensor Fusion. The sensor fusion and torque request mechanism are modeled as a delay of one <span class="math inline">\(100Hz\)</span> control cycle.</p>
<p>A PD controller is selected because of the dynamic setpoint that is being controlled by the cascade arrangement. If we were to include an I term then the controller would not be memoryless and would have undesirable response characteristics to the dynamic <span class="math inline">\(\varphi\)</span> setpoint being requested by the higher level controller. The PD control model is a robust choice for a controller for this robot state parameter, <span class="citation" data-cites="Brevik2017">(<a href="#ref-Brevik2017" role="doc-biblioref">Brevik 2017</a>)</span>.</p>
<p>The MATLAB pid tuner is used to get feasible starting values based on this loop. The experimental parameters applied to the robot were found to closely match the predicted values.</p>
</section>
<section id="pi-controller-for-wheel-velocity" class="level2">
<h2 class="anchored" data-anchor-id="pi-controller-for-wheel-velocity">PI Controller for Wheel Velocity</h2>
<p>The PI controller is tuned heuristically once a good underlying PD controller for the angle is found. A starting value of around <span class="math inline">\(K_p = 0.1\)</span> was found to be helpful. Blending of integral term with a corresponding reduction of <span class="math inline">\(P\)</span> is one approach to further tuning.</p>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Brevik2017" class="csl-entry" role="listitem">
Brevik, Petter. 2017. <span>“Two-Axis Reaction Wheel Inverted Pendulum.”</span> Master's thesis, Norwegian University of Science; Technology. <a href="https://ntnuopen.ntnu.no/ntnu-xmlui/bitstream/handle/11250/2451060/12762_FULLTEXT.pdf?sequence=1">https://ntnuopen.ntnu.no/ntnu-xmlui/bitstream/handle/11250/2451060/12762_FULLTEXT.pdf?sequence=1</a>.
</div>
<div id="ref-caltech2002jacobian" class="csl-entry" role="listitem">
California Institute of Technology. 2002. <span>“Jacobian Linearization.”</span> CDS Caltech. <a href="https://www.cds.caltech.edu/~murray/courses/cds101/fa02/caltech/pph02-ch19-23.pdf">https://www.cds.caltech.edu/~murray/courses/cds101/fa02/caltech/pph02-ch19-23.pdf</a>.
</div>
<div id="ref-Montoya2020" class="csl-entry" role="listitem">
Montoya, Oscar Danilo, and Walter Gil-González. 2020. <span>“Nonlinear Analysis and Control of a Reaction Wheel Pendulum: Lyapunov-Based Approach.”</span> <em>Engineering Science and Technology, an International Journal</em> 23 (1): 21–29. <a href="https://doi.org/10.1016/j.jestch.2019.03.004">https://doi.org/10.1016/j.jestch.2019.03.004</a>.
</div>
<div id="ref-berkeley2021designing" class="csl-entry" role="listitem">
University of California, Berkeley. 2021. <span>“Designing Information Devices and Systems II.”</span> EECS Berkeley. <a href="https://inst.eecs.berkeley.edu/~ee16b/sp21/notes/sp21/note15.pdf">https://inst.eecs.berkeley.edu/~ee16b/sp21/notes/sp21/note15.pdf</a>.
</div>
<div id="ref-Veng2023EulerLagrangeSolver" class="csl-entry" role="listitem">
Veng, Morten. 2023. <span>“<span>Euler-Lagrange Solver</span>.”</span> MATLAB Central File Exchange. <a href="https://www.mathworks.com/matlabcentral/fileexchange/93275-euler-lagrange-solver">https://www.mathworks.com/matlabcentral/fileexchange/93275-euler-lagrange-solver</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/chipnbits\.github\.io");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../../../content/projects/RLUnicycle/telemetry/telemetry.html" class="pagination-link" aria-label="Telemetry and Database System">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Telemetry and Database System</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© 2024, Simon Ghyselincks</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://chipnbits.github.io/">
      <i class="bi bi-house" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/chipnbits">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>